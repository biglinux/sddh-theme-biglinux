#!/usr/bin/env bash

# Ensures that SDDM wallpaper is correct
if [ ! -e "/usr/share/sddm/wallpaper/image.png" ];then
    touch /usr/share/sddm/wallpaper/image.png
    chmod 666 /usr/share/sddm/wallpaper/image.png
    user=$(awk -F':' '{ if ($3 >= 1000 && $1 != "nobody") print $1 }' /etc/passwd | head -n1)
    cp "$(grep -m1 -Po "(?<=^Image=).*" "/home/$user/.config/plasma-org.kde.plasma.desktop-appletsrc" | tr -d '"' | tr -d ';')" /usr/share/sddm/wallpaper/image.png
fi

# if color, change to image
currentTheme=$(awk -F'=' '/Current=/ {print $2; exit}' /etc/sddm.conf.d/kde_settings.conf)
themeConfUser="/usr/share/sddm/themes/$currentTheme/theme.conf.user"
if [ -e "$themeConfUser" ];then
    if [ "$(awk -F'=' '/type=/ {print $2; exit}' $themeConfUser)" = "color" ];then
        sed -i '/s/background=.*/background=/usr/share/sddm/wallpaper/image.png/;s/type=.*/type=image/' $themeConfUser
    fi
fi
